dataApp.controller("selectorCtrl",function($scope,$http){$scope.toggleSelectorForm=function(){$scope.hideForm=!$scope.hideForm},$scope.brand_id=$scope.model_id=$scope.vehicle_uri=$scope.reload="false",$scope.doRefreshBrands=!1,$scope.brands=[],$scope.series_models=[],$scope.vehicles=[],$scope.onInit=function(checkCookies,fetchBrands,currentBrandId,currentSeriesId,modelId,motorId,reload){$scope.reload=reload,$scope.doRefreshBrands=!!fetchBrands,modelId&&motorId?($scope.hideForm=!1,$scope.hideLogo=!1,currentBrandId*currentSeriesId*modelId*motorId!=0?($scope.hideForm=!0,$scope.fetchVehicleDetails(motorId)):$scope.hideLogo=!0):checkCookies?$http({method:"GET",url:shopConf.host.baseUri+"/wsCaller/vehiclecookie"}).then(function(response){if(response.data){var vehicle_id=response.data;$scope.fetchVehicleDetails(vehicle_id,currentBrandId,currentSeriesId)}else $scope.refreshWithoutFetchingVehicleDetails(currentBrandId,currentSeriesId)}):$scope.refreshWithoutFetchingVehicleDetails(currentBrandId,currentSeriesId)},$scope.refreshWithoutFetchingVehicleDetails=function(currentBrandId,currentSeriesId){$scope.doRefreshBrands&&$scope.refreshBrands(currentBrandId),currentBrandId&&""===currentSeriesId?$scope.refreshSeriesModels(currentBrandId):currentSeriesId&&($scope.model_id=currentSeriesId,$scope.refreshSeriesModels(currentBrandId,currentSeriesId),$scope.refreshVehicles(currentSeriesId))},$scope.fetchVehicleDetails=function(vehicle_id,currentBrandId,currentSeriesId){$http({method:"GET",url:shopConf.host.baseUri+"/wsCaller/vehicledetails",params:{id_param:vehicle_id,family_id:family_id,generic_id:generic_id,locale:shopConf.locale}}).then(function(response){if(""!==response.data&&"error"!==response.data.message){var vehicle_details=response.data.element;0<currentBrandId?vehicle_details.id_marque===currentBrandId?($scope.doRefreshBrands&&$scope.refreshBrands(vehicle_details.id_marque),$scope.refreshSeriesModels(vehicle_details.id_marque,vehicle_details.id_modele),$scope.refreshVehicles(vehicle_details.id_modele,vehicle_details.uri_vehicule)):$scope.refreshWithoutFetchingVehicleDetails(currentBrandId,currentSeriesId):($scope.doRefreshBrands&&$scope.refreshBrands(vehicle_details.id_marque),$scope.refreshSeriesModels(vehicle_details.id_marque,vehicle_details.id_modele),$scope.refreshVehicles(vehicle_details.id_modele,vehicle_details.uri_vehicule))}})},$scope.refreshBrands=function(preset_brand_id){$scope.brands_top=[],$scope.brands_all=[],$scope.series_models=[],$scope.vehicles=[],$scope.nb_vehicles=0,$scope.vehicle_uri="false",$scope.model_id="false",$http({method:"GET",url:"/wsCaller/selectorvehiclebrands",params:{locale:shopConf.locale}}).then(function(response){if(""!==response.data&&"error"!==response.data.message){for(var i=0;i<response.data.element.length;i++)"1"===response.data.element[i].principale?$scope.brands_top.push(response.data.element[i]):$scope.brands_all.push(response.data.element[i]);preset_brand_id&&($scope.brand_id=preset_brand_id)}})},$scope.refreshSeriesModels=function(brand_id,preset_model_id){$scope.series_models=[],$scope.vehicles=[],$scope.nb_vehicles=0,$scope.vehicle_uri="false",($scope.model_id="false")!==brand_id&&($scope.brand_id=brand_id,$http({method:"GET",url:shopConf.host.baseUri+"/wsCaller/selectorvehiclemodels",params:{id_param:$scope.brand_id,locale:shopConf.locale}}).then(function(response){""!==response.data&&"error"!==response.data.message&&($scope.model_id="default",$scope.series_models=response.data.element[0].element,preset_model_id&&($scope.model_id=preset_model_id))}))},$scope.refreshVehicles=function(model_id,preset_vehicle_uri){$scope.vehicles=[],$scope.nb_vehicles=0,($scope.vehicle_uri="false")!==model_id&&"default"!==model_id&&($scope.model_id=model_id,$http({method:"GET",url:shopConf.host.baseUri+"/wsCaller/selectorvehiclevehicles",params:{id_param:$scope.model_id,family_id:family_id,generic_id:generic_id,locale:shopConf.locale}}).then(function(response){""!==response.data&&"error"!==response.data.message&&($scope.vehicle_uri="default",$scope.vehicles=response.data.element,$scope.nb_vehicles=Object.keys($scope.vehicles).length,preset_vehicle_uri&&($scope.vehicle_uri=preset_vehicle_uri))}))},$scope.setVehicle=function(vehicle_uri){"false"!==vehicle_uri&&"default"!==vehicle_uri&&($scope.vehicle_uri=vehicle_uri)},$scope.onSubmit=function(){var vehicleUri=$scope.vehicle_uri;if(vehicleUri="/"===vehicleUri[0]?vehicleUri.substr(1,vehicleUri.length):vehicleUri,dataLayer.push({event:"eventGA",category:"selecteur",action:"vehicule",label:vehicleUri}),$scope.reload){var ktypenr=vehicleUri.match("_v([0-9]+).html")[1];setCookie("custom_data_cookie",{ktypenr:ktypenr},100,!0),window.location=self.location}else{var homeRoute=getHomeRouteByDevice(context.device);normalizeUrlAndRelocate(homeRoute+$scope.vehicle_uri)}}});