$(function(){var algoliaSearch=$("#inputfield").find("input"),magnifyButton=$(".algolia-search-box").find(".btn-default"),optionalDelButton="",vehicleId="",searchFilters="";vehicleId="undefined"==typeof attributes||isEmpty(attributes.vehicleId)?(vehicleId=docCookies.getItem("custom_data_cookie"),isEmpty(vehicleId)?"":(vehicleId=JSON.parse(vehicleId)).ktypenr):attributes.vehicleId;var domain=shopConf.home.default.replace(/\/$/,"");switch(shopConf.typePage){case"listing":case"catalog":case"search/algolia":optionalDelButton="";break;default:optionalDelButton='<a class="delete-button" href="#" >('+deleteButton+")</a>"}$("#ktypenr").bind("indexChanged",function(e,ktypenr){$("#inputfield").find("input").autocomplete("destroy"),autoSuggestSearch(ktypenr)});var index=algoliasearch(appId,searchKey).initIndex(indexName);function urlToSearchCategory(category){return searchUrl+"?q=&hierarchicalMenu[categories.lvl0][0]="+encodeURIComponent(category)}function urlToSearch(query){return searchUrl+"?q="+encodeURIComponent(query)}var autoSuggestSearch=function(vehicleId){var hasKtypenr=!(""===vehicleId);function setSource(query,callback){var facet=restrictSearchableAttributes.default,restrict="";switch(this.name){case"product":facet="libelle",restrict=restrictSearchableAttributes.product;break;case"category":facet="categories.lvl2",restrict=restrictSearchableAttributes.category;break;case"manufacturer":facet="equipementier",restrict=restrictSearchableAttributes.manufacturer}index.search(query,{hitsPerPage:1e3,facets:facet,distinct:!0,restrictSearchableAttributes:restrict,typoTolerance:"min",filters:searchFilters,attributesToRetrieve:"image_thumbnail_small,equipementier,categories,equipementier_image,artNr,libelle,url_fa",responseFields:["hits","nbHits","facets"]}).then(function(answer){var facetValue=Object.keys(answer.facets);answer.hits=answer.hits.reduce(function(p,c){return p.some(function(el){switch(facetValue[0]){case"categories.lvl2":return el.categories.lvl2===c.categories.lvl2;case"equipementier":return el.equipementier===c.equipementier}})||p.push(c),p},[]),"equipementier"===facetValue[0]||"categories.lvl2"===facetValue[0]?answer.hits=answer.hits.slice(0,5):answer.hits=answer.hits.slice(0,6),callback(answer.hits,answer)},function(){callback([])})}""!==vehicleId&&(searchFilters="ktypenr:0<score=1> OR ktypenr:"+vehicleId+"<score=accessori_type>",$.ajax({method:"GET",url:shopConf.host.baseUri+"/wsCaller/vehicledetails",dataType:"json",data:{id_param:vehicleId,locale:shopConf.locale},success:function(response){if("1"===response.status){var vehicleDetails=response.element,vehicleLink='<div id="algolia-search-box-vehicle" class="algolia-search-box-vehicle"><img src="'+shopConf.host.static2+"/img/commun/body/constructeur/small/"+vehicleDetails.id_marque+'.jpg" class="brand-img" alt="'+vehicleDetails.libelle+'"/> <a class="vehicle-name" href="'+shopConf.home.default+vehicleDetails.uri_vehicule+'">'+vehicleDetails.libelle+"</a> "+optionalDelButton+"</div>";$(".algolia-search-box-vehicle").replaceWith(vehicleLink),$(".delete-button").click(function(){setCookie("custom_data_cookie","",-1),location.reload()})}}})),algoliaSearch.autocomplete({hint:!1,debug:!1,openOnFocus:!0,dropdownMenuContainer:".algolia-autocomplete-container",templates:{dropdownMenu:'<div class="container"><div class="row"><div class="col-sm-6"><div class="aa-dataset-category"></div><div class="aa-dataset-manufacturer"></div></div><div class="aa-dataset-product col-sm-6"></div></div></div>'}},[{source:setSource,displayKey:"libelle",name:"product",templates:{header:function(suggestion,answer){return'<div class="h3">'+transProducts+" <span>("+answer.hits.length+"/"+answer.nbHits+")</span></div>"},suggestion:function(suggestion){var ref="";return void 0!==suggestion.artNr&&(ref=transRef+" "+suggestion._highlightResult.artNr.value),'<div class="row"><div class="col-sm-accessori_type"><img src="'+suggestion.image_thumbnail_small+'"></div><div class="col-sm-10"><div class="manufacturer-label">'+suggestion.equipementier+' <span class="ref-label">'+ref+'</span></div><span class="high-light-label" data-selenium="span_algolia_suggestion'+suggestion._highlightResult.artNr.value+'">'+suggestion._highlightResult.libelle.value+"</span></div></div>"},footer:function(suggestion,answer){return 0!==answer.nbHits||hasKtypenr?0===answer.nbHits&&hasKtypenr?'<div class="no-product-container"><p class="no-product-text">'+translationNoProductForVehicle+'</p><a class="btn btn-primary btn-inline-block" href="/catalog_v'+vehicleId+'.html">'+translationSeeCatalogVehicle+"</a></div>":'<div class="text-center"><a href="'+searchUrl+"?q="+suggestion.query+'" class="see-allproducts btn btn-more">'+seeMoreProducts+" ("+answer.nbHits+")</a></div>":'<div class="no-product-container"><p class="no-product-text">'+translationNoProductForVehicle+"</p></div>"},empty:function(suggestion){var query;query=suggestion.query,index.search(query,{restrictSearchableAttributes:restrictSearchableAttributes.category,optionalWords:query,typoTolerance:"min",facets:"categories.lvl2",responseFields:"facets"},function(err,content){if(!err){var families=[],categoriesToDisplay='<div class="h3">'+transCategories+"</div>";Object.keys(content.facets["categories.lvl2"]).sort(function(a,b){return content.facets["categories.lvl2"][a]+content.facets["categories.lvl2"][b]}).slice(0,10).forEach(function(category){var categoryLevels=category.split(">"),htmlFamily=function(categoryLevels){return'<mark class="family" data-family-query="'+categoryLevels[1].trim()+'">'+categoryLevels[1].trim().toLowerCase()+"</mark>"}(categoryLevels);categoriesToDisplay+=function(category,categoryLevels){return categoryLevels[2]="<strong>"+categoryLevels[2]+"</strong>",'<div class="aa-suggestion"><span class="high-light-category category-fuzzy" data-category-query="'+category+'">'+categoryLevels.join("&gt;")+"</span></div>"}(category,categoryLevels),families.length<=6&&-1===families.indexOf(htmlFamily)&&families.push(htmlFamily)}),families=families.sort(function(a,b){return a===b?0:b<a?1:-1}),categoriesToDisplay='<div class="aa-suggestions">'+categoriesToDisplay+"</div>";var familiesToDisplay='<div class="try-keywords-container"><p>'+translationNoProductOnMA+'</p><div class="try-keywords"><span class="keywords-text">'+translationTryKeywords+"</span> "+families.join(" ")+"</div></div>";$(".aa-dataset-category").html(categoriesToDisplay).on("click",".category-fuzzy",function(event){event.stopPropagation(),window.location.assign(urlToSearchCategory($(this).data("category-query")))}),$(".aa-dataset-manufacturer").html(familiesToDisplay).on("click",".family",function(event){event.stopPropagation(),window.location.assign(urlToSearch($(this).data("family-query")))})}})}}},{source:setSource,displayKey:function(suggestion){return suggestion._highlightResult.categories.lvl2.value.split(" > ").pop().replace(/(<([^>]+)>)/gi,"")},name:"category",templates:{header:'<div class="h3">'+transCategories+"</div>",suggestion:function(suggestion,answer){var catSuggest=suggestion.categories.lvl2.split(" > ");return catSuggest[2]='<strong data-selenium="strong_algolia_suggestion'+suggestion._highlightResult.artNr.value+'">'+catSuggest[2]+"</strong>",'<span class="high-light-category">'+(suggestion=catSuggest.join(" > "))+"</span>"}}},{source:setSource,displayKey:"equipementier",name:"manufacturer",templates:{header:'<div class="h3">'+transBrands+"</div>",suggestion:function(suggestion){return'<div class="row"><div class="col-sm-accessori_type"><img src="'+suggestion.equipementier_image+'"></div><div class="col-sm-10"><span class="high-light-brand" data-selenium="span_algolia_manufacturer'+suggestion._highlightResult.equipementier.value+'">'+suggestion._highlightResult.equipementier.value+"</span></div></div>"}}}]).on("autocomplete:selected",function(event,suggestion,dataset){dataLayer.push({event:"eventGA",category:"siteSearch",action:"autoSuggest",label:dataset});var query=encodeURIComponent(algoliaSearch.autocomplete("val")),urlTarget="";switch(dataset){case"product":urlTarget=domain+"/"+suggestion.url_fa;break;case"category":urlTarget=urlToSearchCategory(suggestion.categories.lvl2);break;case"manufacturer":urlTarget=urlToSearch(suggestion.equipementier);break;default:urlTarget=urlToSearch(query)}normalizeUrlAndRelocate(urlTarget)}),algoliaSearch.keypress(function(e){if(13===e.which){var query=encodeURIComponent(algoliaSearch.val());normalizeUrlAndRelocate(searchUrl+"?q="+query)}}),magnifyButton.click(function(){var query=encodeURIComponent(algoliaSearch.val());normalizeUrlAndRelocate(searchUrl+"?q="+query)})};autoSuggestSearch(vehicleId)});